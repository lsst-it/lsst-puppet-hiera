---
# IT Services Layout
# Network List at Cerro Pachon:
#       * 139.229.160.0/24 - General Services Servers
#       * 139.229.162.0/24 - Users' Network
#
# Services List
# DHCP Master Server            : 139.229.162.120
# DHCP Slave Server             : 139.229.160.121
# DNS Master                    : 139.229.160.248 (Not deployed yet)
# DNS Slave                     : 139.229.160.247 (Not deployed yet)
# DNS Cache 1                   : 139.229.160.246 (Not deployed yet)
# DNS Cache 2                   : 139.229.160.245 (Not deployed yet)
# Graylog Master                : 139.229.162.106
# Graylog Slave                 : 139.229.160.243 (Not deployed yet)
# InfluxDB Master               : 139.229.162.104
# InfluxDB Slave                : 139.229.160.241 (Not deployed yet)
# Grafana                       : 139.229.162.105
# Puppet Master                 : 139.229.160.239 (Not deployed yet)


# Rsyslog configuration is based on the default rsyslog.conf shipping with CentOS 7.7
rsyslog::config::global_config:
  workDirectory:
    value: "/var/lib/rsyslog"
  maxMessageSize:
    value: "64k"
  preserveFQDN:
    value: "on"
rsyslog::config::modules:
  imuxsock: {}
  imjournal:
    config:
      StateFile: "imjournal.state"
      IgnorePreviousMessages: "off"
      Ratelimit.Interval: 600
      Ratelimit.Burst: 20000
  imklog: {}
  immark: {}
  imfile: {}
rsyslog::config::actions:
  graylog:
    type: "omfwd"
    facility: "*.*;auth,authpriv.none"
    config:
      Target: "gs-graylog-node-01.cp.lsst.org"
      Port: 5514
      Protocol: "udp"
  # Log anything (except mail) of level info or higher.
  # Don't log private authentication messages!
  messages:
    type: "omfile"
    facility: "*.info;mail.none;authpriv.none;cron.none"
    config:
      file: "/var/log/messages"
  # The authpriv file has restricted access.
  secure:
    type: "omfile"
    facility: "authpriv.*"
    config:
      file: "/var/log/secure"
  # Everybody gets emergency messages
  emerg:
    type: "omusrmsg"
    facility: "*.emerg"
    config:
      users: "*"
  maillog:
    type: "omfile"
    facility: "mail.*"
    config:
      file: "-/var/log/maillog"
  cron:
    type: "omfile"
    facility: "cron.*"
    config:
      file: "/var/log/cron"
  # local7 does not appear to be used by CentOS 7, but for the sake of
  # consistency we preserve it to match the CentOS configuration.
  boot:
    type: "omfile"
    facility: "local7.*"
    config:
      file: "-/var/log/boot.log"

# Telegraf common configuration
monitoring_enabled: true
telegraf::global_tags:
  service: "%{::service}"
  cluster: "%{::cluster}"
  device: "%{::device}"
  service_number: "%{::service_number}"
  device_number: "%{::device_number}"
  node_name: "%{::node_name}"
  datacenter: "%{::datacenter}"
  type: "%{::virtual}"
telegraf::interval: "1m"
telegraf::round_interval: true
telegraf::metric_batch_size: 1000
telegraf::metric_buffer_limit: 10000
telegraf::collection_jitter: "0s"
telegraf::flush_interval: "1m"
telegraf::flush_jitter: "0m"
telegraf::debug: false
telegraf::quiet: false
telegraf::hostname: ""
telegraf::omit_hostname: false

# The following keys are shared between the `dhcp` and `resolv_conf` classes:
# - dhcp::dnsdomain
# - dhcp::nameservers
# - dhcp::ntpservers
#
# @see clusters/corecp/dhcp.yaml

# resolv.conf allows for a maximum of 6 search domains with a max length of 256
# characters.
# @see man 5 resolv.conf
dhcp::dnsdomain: &dnsdomains
  - "cp.lsst.org"
  - "cp.cl.lsst.org"
  - "cl.lsst.org"
  - "lsst.org"
  - "lsst.local"
# resolv.conf allows for a maximum of 3 nameservers
# @see man 5 resolv.conf
dhcp::nameservers: &nameservers
  - "139.229.162.22"  # dns1.cp.lsst.org
  - "139.229.162.87"  # dns2.cp.lsst.org
  - "208.67.222.222"  # resolver1.opendns.com
dhcp::ntpservers: &ntpservers
  - "ntp.shoa.cl"
  - "1.cl.pool.ntp.org"
  - "1.south-america.pool.ntp.org"

chrony::servers: *ntpservers
resolv_conf::nameservers: *nameservers
resolv_conf::searchpath: *dnsdomains
